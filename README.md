SimHash Watermarking and Detection Project

This project focuses on implementing watermarking, paraphrasing, and detection techniques for text generated by language models. It uses the SimHash algorithm for embedding-based watermarking and includes utilities for generating watermarked text, paraphrased versions, and unrelated text to evaluate the performance of the watermarking scheme.

File Descriptions

1. experiments_simhash.py

This script performs experiments to evaluate the SimHash watermarking and detection techniques. It generates watermarked text, paraphrased text, and unrelated text, computes their detection metrics, and visualizes the results.

Key Components:

paraphrase_text: Generates a paraphrased version of a given text using a placeholder replacement strategy (replace a with e).

generate_unrelated_text: Dynamically generates unrelated text by using predefined unrelated topics and prompts. It also uses randomness to ensure diversity.

run_experiment: Main function to run the experiments. It:

Generates watermarked, paraphrased, and unrelated text.

Detects the watermark in each text type.

Computes and visualizes average minimum costs for different text categories.

Outputs:

Saves the generated text and detection results to text_outputs.txt.

Plots a bar chart visualizing the average minimum costs for watermarked, paraphrased, and unrelated text.

2. generate_simhash.py

This module implements the watermarking logic using the SimHash algorithm.

Key Components:

simple_encoder: Encodes input text into embeddings using the last hidden state of the language model.

SimHashWatermark: Class that implements the SimHash watermarking process:

Generates hash functions using precomputed Gaussian vectors.

Computes hash values and uses them to deterministically sample random vectors.

generate_with_simhash: Main function to generate watermarked text by integrating SimHash with exponential minimum sampling for token selection.

3. detection_simhash.py

This module implements the watermark detection logic.

Key Components:

simple_encoder: (Reused) Encodes text into embeddings.

simhash_detect_with_permutation: Detects the watermark in a given token by:

Computing a test statistic for the observed token.

Performing a permutation test to compute a p-value.

Returning the p-value, detection result, and minimum cost.

4. test_simhash.py

This script tests the SimHash watermarking and detection for different combinations of parameters (k and b) and visualizes the results as a heatmap.

Key Components:

example_with_detection: Tests the watermarking and detection for different parameter combinations.

Heatmap Visualization: Plots a heatmap of p-values for various combinations of k (number of hash functions) and b (bits per hash).

How to Use

Install Dependencies:
Ensure you have Python 3.7+ and the following libraries installed:

torch

transformers

matplotlib

numpy

Install them using pip:

pip install torch transformers matplotlib numpy

Run Experiments:
To run the main experiment script:

python3 experiments_simhash.py

This will generate watermarked, paraphrased, and unrelated text, compute detection metrics, and visualize the results.

Test Parameter Combinations:
To evaluate the watermarking and detection for different k and b values:

python3 test_simhash.py

View Outputs:

Generated text and metrics are saved to text_outputs.txt.

Plots and visualizations are displayed interactively.

Project Structure

.
├── experiments_simhash.py      # Main experiment script
├── generate_simhash.py         # SimHash watermarking implementation
├── detection_simhash.py        # SimHash detection logic
├── test_simhash.py             # Parameter testing and visualization
└── README.md                   # Project documentation

Customization

Text Generation Parameters: Modify k, b, m, and n in the scripts to experiment with different watermarking configurations.

Unrelated Text Generation: Enhance the generate_unrelated_text function to use external APIs or more complex logic for generating unrelated text.

Paraphrasing Logic: Replace the placeholder paraphrase_text function with a robust paraphrasing model (e.g., Hugging Face's T5 or Pegasus).

Notes

Ensure that the pretrained model (facebook/opt-1.3b) is downloaded correctly. Change the model name in the scripts if a different model is needed.

The minimum cost values (min_cost) are used as a key metric to evaluate the effectiveness of the watermarking scheme.

Future Improvements

Incorporate semantic similarity checks to ensure unrelated text is truly distant from watermarked content.

Add more sophisticated paraphrasing techniques to simulate real-world text transformations.

Evaluate performance with larger language models and diverse datasets.

License

This project is open-source and can be used for research and educational purposes.

